<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Plot outputs of apm_pre() — plot.apm_pre_fits • apm</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plot outputs of apm_pre() — plot.apm_pre_fits"><meta name="description" content="plot() displays the Bayesian model averaging (BMA) weights for each model (computed by apm_fit() as the posterior probability of selection) and the distribution of the difference in average prediction errors."><meta property="og:description" content="plot() displays the Bayesian model averaging (BMA) weights for each model (computed by apm_fit() as the posterior probability of selection) and the distribution of the difference in average prediction errors."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">apm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/apm.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tl2624/apm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Plot outputs of <code>apm_pre()</code></h1>
      <small class="dont-index">Source: <a href="https://github.com/tl2624/apm/blob/main/R/plot.apm_pre_fits.R" class="external-link"><code>R/plot.apm_pre_fits.R</code></a></small>
      <div class="d-none name"><code>plot.apm_pre_fits.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> displays the Bayesian model averaging (BMA) weights for each model (computed by <code>apm_fit()</code> as the posterior probability of selection) and the distribution of the difference in average prediction errors.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'apm_pre_fits'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"weights"</span>,</span>
<span>  abs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">4L</span>,</span>
<span>  clip_at <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  model <span class="op">=</span> <span class="st">".optimal"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>an <code>apm_pre_fits</code> object; the output of a call to <code><a href="apm_pre.html">apm_pre()</a></code>.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>which values to plot: allowable options include <code>"weights"</code> to plot the BMA weights/posterior probabilities (default), <code>"errors"</code> to plot the difference in average predictions errors for all models across validation periods, <code>"predict"</code> to plot the time series and model predictions for each model, and <code>"corrected"</code> to plot the corrected predictions for the treated group for each model. Abbreviations allowed.</p></dd>


<dt id="arg-abs">abs<a class="anchor" aria-label="anchor" href="#arg-abs"></a></dt>
<dd><p><code>logical</code>; when <code>type = "errors"</code>, whether to plot the differences in average prediction errors in absolute value (<code>TRUE</code>, default) or not (<code>FALSE</code>).</p></dd>


<dt id="arg-ncol">ncol<a class="anchor" aria-label="anchor" href="#arg-ncol"></a></dt>
<dd><p>when <code>type</code> is <code>"errors"</code>, <code>"predict"</code>, or <code>"corrected"</code>, the number of columns to use to display the plots. Default is 4.</p></dd>


<dt id="arg-clip-at">clip_at<a class="anchor" aria-label="anchor" href="#arg-clip-at"></a></dt>
<dd><p>when <code>type = "errors"</code>, the value (in robust z-score units) at which to clip the y-axis of the plot to prevent outliers from distorting it. Default is 15. Set to <code>Inf</code> to prevent clipping.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>string; when <code>type = "predict"</code> or <code>type = "corrected"</code>, the model(s) to plot. Allowable values include <code>".optimal"</code> to plot the model with the smallest maximum absolute difference in average prediction errors, <code>".all"</code> to plot all models (excluding the BMA-weighted predictions), or the names of one or more specific models. Abbreviations allowed.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>ignored.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>ggplot</code> object, which can be manipulated using <code>ggplot2</code> syntax (after loading <code>ggplot2</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When <code>type = "weights"</code>, <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> displays a bar plot with a bar for each model with height equal to the BMA weight/posterior probability of selection for that model. (Note that the plot margins can sometimes cut off the model names; use <code>theme(plot.margins =)</code> after loading <code>ggplot2</code> to extend the left margin of the plot to ensure all text is visible. Alternatively, the axis text can be rotated using <code>theme(axis.text.x =)</code>.)</p>
<p>When <code>type = "errors"</code>, <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> displays a lattice of bar plots with a plot for each model displaying the difference in average prediction errors for each validation period. The period with the largest difference in average prediction errors will be shaded black. The model with the smallest maximum absolute difference in average prediction errors will have a gray label.</p>
<p>When <code>type = "predict"</code>, <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> displays a lattice of line plots with a plot for each model displaying the observed and predicted outcomes for each validation period under each model. The observed outcomes are displayed as points, while the predicted outcomes are displayed as lines.</p>
<p>When <code>type = "corrected"</code>, <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> displays a lattice of line plots with a plot for each model displaying the observed and corrected predictions for the treated group for each validation period under each model. The observed outcomes are displayed as points, while the corrected predictions are displayed as lines. Corrected predictions are computed as the observed outcome in the treated group minus the prediction error in the treated group plus the prediction error in the control group.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="apm_pre.html">apm_pre()</a></code> to to compute the difference in average prediction errors and BMA weights; <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">ggplot2::geom_col()</a></code>, which is used to create the plots.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ptpdata"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Combination of 8 models: 2 baseline formulas,</span></span></span>
<span class="r-in"><span><span class="co"># 2 families, 2 lags</span></span></span>
<span class="r-in"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="apm_mod.html">apm_mod</a></span><span class="op">(</span><span class="va">crude_rate</span> <span class="op">~</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>                   family <span class="op">=</span> <span class="st">"gaussian"</span>,</span></span>
<span class="r-in"><span>                   time_trend <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                   lag <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                   diff_k <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">models</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Model 1: baseline mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> crude_rate ~ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> family: gaussian(link = "identity")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome lag: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome diff: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log outcome: no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> time trend: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> unit fixed effects: no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Model 2: AR(1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> crude_rate ~ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> family: gaussian(link = "identity")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome lag: 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome diff: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log outcome: no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> time trend: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> unit fixed effects: no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Model 3: baseline mean (1st diff)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> crude_rate ~ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> family: gaussian(link = "identity")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome lag: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome diff: 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log outcome: no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> time trend: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> unit fixed effects: no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Model 4: linear trend</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> crude_rate ~ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> family: gaussian(link = "identity")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome lag: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome diff: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log outcome: no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> time trend: linear</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> unit fixed effects: no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Model 5: linear trend + AR(1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> crude_rate ~ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> family: gaussian(link = "identity")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome lag: 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome diff: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log outcome: no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> time trend: linear</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> unit fixed effects: no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> - Model 6: linear trend (1st diff)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> crude_rate ~ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> family: gaussian(link = "identity")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome lag: none</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> outcome diff: 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log outcome: no</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> time trend: linear</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> unit fixed effects: no</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit the models to data</span></span></span>
<span class="r-in"><span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="apm_pre.html">apm_pre</a></span><span class="op">(</span><span class="va">models</span>, data <span class="op">=</span> <span class="va">ptpdata</span>,</span></span>
<span class="r-in"><span>                 group_var <span class="op">=</span> <span class="st">"group"</span>,</span></span>
<span class="r-in"><span>                 time_var <span class="op">=</span> <span class="st">"year"</span>,</span></span>
<span class="r-in"><span>                 val_times <span class="op">=</span> <span class="fl">1999</span><span class="op">:</span><span class="fl">2007</span>,</span></span>
<span class="r-in"><span>                 unit_var <span class="op">=</span> <span class="st">"state"</span>,</span></span>
<span class="r-in"><span>                 nsim <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitting models... Done.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simulating to compute BMA weights...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                  | 0 % ~calculating    |+                                                 | 2 % ~00s            |++                                                | 4 % ~00s            |+++                                               | 6 % ~00s            |++++                                              | 8 % ~00s            |+++++                                             | 10% ~00s            |++++++                                            | 12% ~00s            |+++++++                                           | 14% ~00s            |++++++++                                          | 16% ~00s            |+++++++++                                         | 18% ~00s            |++++++++++                                        | 20% ~00s            |+++++++++++                                       | 22% ~00s            |++++++++++++                                      | 24% ~00s            |+++++++++++++                                     | 26% ~00s            |++++++++++++++                                    | 28% ~00s            |+++++++++++++++                                   | 30% ~00s            |++++++++++++++++                                  | 32% ~00s            |+++++++++++++++++                                 | 34% ~00s            |++++++++++++++++++                                | 36% ~00s            |+++++++++++++++++++                               | 38% ~00s            |++++++++++++++++++++                              | 40% ~00s            |+++++++++++++++++++++                             | 42% ~00s            |++++++++++++++++++++++                            | 44% ~00s            |+++++++++++++++++++++++                           | 46% ~00s            |++++++++++++++++++++++++                          | 48% ~00s            |+++++++++++++++++++++++++                         | 50% ~00s            |++++++++++++++++++++++++++                        | 52% ~00s            |+++++++++++++++++++++++++++                       | 54% ~00s            |++++++++++++++++++++++++++++                      | 56% ~00s            |+++++++++++++++++++++++++++++                     | 58% ~00s            |++++++++++++++++++++++++++++++                    | 60% ~00s            |+++++++++++++++++++++++++++++++                   | 62% ~00s            |++++++++++++++++++++++++++++++++                  | 64% ~00s            |+++++++++++++++++++++++++++++++++                 | 66% ~00s            |++++++++++++++++++++++++++++++++++                | 68% ~00s            |+++++++++++++++++++++++++++++++++++               | 70% ~00s            |++++++++++++++++++++++++++++++++++++              | 72% ~00s            |+++++++++++++++++++++++++++++++++++++             | 74% ~00s            |++++++++++++++++++++++++++++++++++++++            | 76% ~00s            |+++++++++++++++++++++++++++++++++++++++           | 78% ~00s            |++++++++++++++++++++++++++++++++++++++++          | 80% ~00s            |+++++++++++++++++++++++++++++++++++++++++         | 82% ~00s            |++++++++++++++++++++++++++++++++++++++++++        | 84% ~00s            |+++++++++++++++++++++++++++++++++++++++++++       | 86% ~00s            |++++++++++++++++++++++++++++++++++++++++++++      | 88% ~00s            |+++++++++++++++++++++++++++++++++++++++++++++     | 90% ~00s            |++++++++++++++++++++++++++++++++++++++++++++++    | 92% ~00s            |+++++++++++++++++++++++++++++++++++++++++++++++   | 94% ~00s            |++++++++++++++++++++++++++++++++++++++++++++++++  | 96% ~00s            |+++++++++++++++++++++++++++++++++++++++++++++++++ | 98% ~00s            |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=00s  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Done.</span>
<span class="r-in"><span><span class="va">fits</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An `apm_pre_fits` object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - grouping variable: group</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - unit variable: state</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - time variable: year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    - validation times: 1999, 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of models compared: 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of simulation iterations: 50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use `summary()` or `plot()` to examine prediction errors and BMA weights.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fits</span>, type <span class="op">=</span> <span class="st">"weights"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.apm_pre_fits-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fits</span>, type <span class="op">=</span> <span class="st">"error"</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.apm_pre_fits-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fits</span>, type <span class="op">=</span> <span class="st">"predict"</span>, model <span class="op">=</span> <span class="st">".optimal"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.apm_pre_fits-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fits</span>, type <span class="op">=</span> <span class="st">"corrected"</span>, model <span class="op">=</span> <span class="st">".optimal"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.apm_pre_fits-4.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Leavitt, Laura Hatfield, Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

